{% extends "base.html" %}

{# Group template - used for tags index, authors index, archive index, etc. #}
{# This template shows a list of groups (tags, authors, years) and their content counts #}

{% block main %}

{# Page Title #}

{# Group Listing with IndieWeb h-feed #}
<section class="groups-list h-feed">
    <h1 class="p-name" style="display: none;">{{ title }}</h1>

    {% for name, items in group(kind=kind) %}
    {% if kind == "stream" and name == "draft" %}{% continue %}{% endif %}
    <fieldset class="group-item">
        {% set slug = name | trim | slugify %}
        {% if kind != "stream" %}
        {% set slug = kind ~ "-" ~ slug %}
        {% endif %}
        {% set link = slug ~ ".html"%}
        <legend>
            <a href="{{url_for(path=link)}}" style="text-decoration: none; color: inherit;">
                {%if kind == "author" %}{% include "group_author_avatar.html" ignore missing%}{% endif %}
                {% if kind == "stream" %}{{ stream_display_name(stream=name) }}{% elif kind == "series" %}{{ series_display_name(series=name) }}{% else %}{{name}}{% endif %}
            </a>
            <span class="group-count" style="font-weight: normal;"> ({{ items | remove_draft | length }})</span>
        </legend>
        
        <ul class="tree-view" style="margin: 0;">
            {# Show preview of recent posts in this group #}
            {% for post in items | remove_draft | sort(attribute="date") | reverse | slice(end=5) %}
            <li class="h-entry">
                <a href="{{url_for(path=post.slug ~ '.html')}}" class="u-url p-name">{{ post.title }}</a>
                {% if post.date %}
                <small class="group-preview-date" style="margin-left: 8px;"><time class="dt-published" datetime="{{ post.date | date(format='%+') }}">{{ post.date | date(format='%b %Y') }}</time></small>
                {% endif %}
            </li>
            {% endfor %}
            {% if items | remove_draft | length > 5 %}
            <li style="font-style: italic;">...and {{ items | remove_draft | length - 5 }} more</li>
            {% endif %}
        </ul>
    </fieldset>
    {% endfor %}
</section>

{# Back to main navigation #}
<div class="group-navigation">
    <button onclick="window.location.href='{{url_for(path='index.html')}}'">
        üè† Back to Home
    </button>
</div>

{% endblock %}
